# VM integration attempt â€” 2025-12-23T023032Z (UTC)

## Command
- `PYTEST_DISABLE_PLUGIN_AUTOLOAD=1 BOOT_IMAGE_VM_SPAWN_TIMEOUT=900 BOOT_IMAGE_VM_LOGIN_TIMEOUT=300 pytest tests/vm/test_pre_nixos_vm.py tests/vm/test_pre_nixos_cleanup.py -q`

## Results
- All four VM scenarios errored while validating shell privileges. The harness failed to parse the `id -u` sentinel after configuring the prompt; the login transcript shows garbled serial output interleaving with the prompt and UID marker, leading to the assertion failure. No scenarios advanced past the initial root-escalation check.

## Timings (from metadata)
- Build: 697.613s
- Harness runtime (VM interaction): 162.925s
- Start: 2025-12-23T02:27:39.746850+00:00
- End: 2025-12-23T02:30:22.754670+00:00

## Artifacts
- Copied harness/serial logs and diagnostics: `notes/2025-12-23T023032Z-vm-run/logs`
  - Harness log: `notes/2025-12-23T023032Z-vm-run/logs/harness.log`
  - Serial log: `notes/2025-12-23T023032Z-vm-run/logs/serial.log`
  - Metadata: `notes/2025-12-23T023032Z-vm-run/logs/metadata.json`
  - Diagnostics: `notes/2025-12-23T023032Z-vm-run/logs/diagnostics/`
- Ledger updated: `notes/vm-run-ledger.jsonl`

## Notes
- Serial log contains heavy boot menu output and prompt configuration lines; UID marker appears concatenated with prompt text (`printfprintf`), which prevented the harness from parsing `id -u`.
- Next step: refine prompt/UID emission to resist echoed characters and ensure a clean line before parsing (e.g., stronger flushing of prior output or stricter read loop).
