# VM integration attempt â€” 2025-12-24T13:57:00Z (UTC)

## Command
- `pytest tests/vm/test_pre_nixos_vm.py tests/vm/test_pre_nixos_cleanup.py -q`

## Result
- **Failed** in ~13m: 2 failing, 2 passing.
- Build time ~532s; boot-to-login ~125s; boot-to-SSH ~235s (see `notes/2025-12-24T134912Z-vm-run/logs/metadata.json`).

## Findings
- Pre-nixos auto-provisioned VGs named `large` and `swap`; expected `main` was missing, causing `test_boot_image_provisions_clean_disk` to fail. Serial log captured `vgs` output with only `large` and `swap` entries.
- During the RAID/LVM residue scenario, the initial `mdadm --create /dev/md127 ... /dev/vdb /dev/vdc` command failed with `Device or resource busy` because pre-nixos had already consumed `/dev/vdb` and `/dev/vdc` for `md0`. The failure surfaced as a `TypeError` because `BootImageVM._raise_with_transcript` did not accept the `body` argument.
- Diagnostics recorded under `notes/2025-12-24T134912Z-vm-run/logs/`, including harness/serial logs and `pre-nixos` journal extracts.

## Next steps
- Teach `_raise_with_transcript` to handle failure context bodies so checked command failures report their output instead of raising `TypeError`.
- Decide how to keep `/dev/vdb` and `/dev/vdc` free for the residue scenario (e.g., avoid provisioning them during the initial auto-apply or reseed against other devices).
- Re-run the VM suite after freeing the extra disks to confirm whether the `main` VG expectation still fails.
