
ISOLINUX 6.04   Copyright (C) 1994-2015 H. Peter Anvin et al
e%@)0(B[0;37;40m[?25l[2J[1;1H[0;30;44mlqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk[2;1H[0;30;44mx[0;1;36;44m                                             NixOS                                              [0;30;44mx[3;1H[0;30;44mtqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqu[4;1H[0;30;44mx[0;7;37;40m NixOS 24.05.20241230.b134951 Installer                                                         [0;30;44mx[5;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (nomodeset)                                             [0;30;44mx[6;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (copytoram)                                             [0;30;44mx[7;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (debug)                                                 [0;30;44mx[8;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (serial console=ttyS0,115200n8)                         [0;30;44mx[9;1H[0;30;44mx[0;37;44m Memtest86+                                                                                     [0;30;44mx[10;1H[0;30;44mmqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj[0;31;40m[34;36HPress [Tab] to edit options[0;37;40m[35;1H[0;37;40m[35;1H[K[K[36;1H[33;34H[0;37;40mAutomatic boot in [0;1;37;40m10[0;37;40m seconds...[33;34H[0;37;40m Automatic boot in [0;1;37;40m9[0;37;40m seconds... [33;35H[0;37;40mAutomatic boot in [0;1;37;40m8[0;37;40m seconds...[33;35H[0;37;40mAutomatic boot in [0;1;37;40m7[0;37;40m seconds...[33;35H[0;37;40mAutomatic boot in [0;1;37;40m6[0;37;40m seconds...[33;35H[0;37;40mAutomatic boot in [0;1;37;40m5[0;37;40m seconds...[33;35H[0;37;40mAutomatic boot in [0;1;37;40m4[0;37;40m seconds...[33;35H[0;37;40mAutomatic boot in [0;1;37;40m3[0;37;40m seconds...[33;35H[0;37;40mAutomatic boot in [0;1;37;40m2[0;37;40m seconds...[33;34H[0;37;40m Automatic boot in [0;1;37;40m1[0;37;40m second... [1;1H[0;30;44mlqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqk[2;1H[0;30;44mx[0;1;36;44m                                             NixOS                                              [0;30;44mx[3;1H[0;30;44mtqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqu[4;1H[0;30;44mx[0;7;37;40m NixOS 24.05.20241230.b134951 Installer                                                         [0;30;44mx[5;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (nomodeset)                                             [0;30;44mx[6;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (copytoram)                                             [0;30;44mx[7;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (debug)                                                 [0;30;44mx[8;1H[0;30;44mx[0;37;44m NixOS 24.05.20241230.b134951 Installer (serial console=ttyS0,115200n8)                         [0;30;44mx[9;1H[0;30;44mx[0;37;44m Memtest86+                                                                                     [0;30;44mx[10;1H[0;30;44mmqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqj[0;31;40m[34;36HPress [Tab] to edit options[0;37;40m[35;1H[?25he%@)0(B[0;37;40m[?25l[2J[?25h[35;1H[0mLoading /boot/bzImage... ok
Loading /boot/initrd...ok


[1;32m<<< Welcome to NixOS 24.05.20241230.b134951 (x86_64) - ttyS0 >>>[0m
The "nixos" and "root" accounts have empty passwords.

To log in over ssh you must set a password for either "nixos" or "root"
with `passwd` (prefix with `sudo` for "root"), or add your public key to
/home/nixos/.ssh/authorized_keys or /root/.ssh/authorized_keys.

If you need a wireless connection, type
`sudo systemctl start wpa_supplicant` and configure a
network using `wpa_cli`. See the NixOS manual for details.


Run 'nixos-help' for the NixOS manual.

nixos login: nixos (automatic login)

export PS1='PRE-NIXOS> '
export PS1='PRE-NIXOS> '
id -u
id -u
[?2004h
[1;32m[]0;nixos@nixos: ~nixos@nixos:~]$[0m export PS1='PRE-NIXOS> '
[?2004l[?2004hPRE-NIXOS> id -u
[?2004l1000
[?2004hPRE-NIXOS> sudo -i
sudo -i
[?2004l[?2004h
[1;31m[]0;root@nixos: ~root@nixos:~]#[0m export PS1='PRE-NIXOS> '
export PS1='PRE-NIXOS> '
id -u
[?2004l[?2004hPRE-NIXOS> id -u
[?2004l0
[?2004hPRE-NIXOS> pre-nixos-detect-storage
pre-nixos-detect-storage
[?2004l[?2004hPRE-NIXOS> pre-nixos --plan-only
pre-nixos --plan-only
[?2004l{"authorized_key": null, "event": "pre_nixos.network.configure_lan.start", "net_path": "/sys/class/net", "network_dir": "/etc/systemd/network", "root_home": "/root", "ssh_dir": "/etc/ssh", "ssh_service": "sshd", "timestamp": "2025-10-19T04:08:32.526952+00:00"}
{"attempts": 30, "delay_seconds": 2.0, "event": "pre_nixos.network.wait_for_lan.start", "net_path": "/sys/class/net", "timestamp": "2025-10-19T04:08:32.542809+00:00"}
{"command": ["ip", "link", "set", "lan", "up"], "event": "pre_nixos.network.command.start", "timestamp": "2025-10-19T04:08:32.550786+00:00"}
{"command": ["ip", "link", "set", "lan", "up"], "event": "pre_nixos.network.command.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:32.656232+00:00"}
{"event": "pre_nixos.network.identify_lan.detected", "interface": "lan", "signal": "carrier", "timestamp": "2025-10-19T04:08:32.670024+00:00"}
{"event": "pre_nixos.network.wait_for_lan.detected", "interface": "lan", "timestamp": "2025-10-19T04:08:32.671109+00:00"}
{"event": "pre_nixos.network.configure_lan.detected_interface", "interface": "lan", "timestamp": "2025-10-19T04:08:32.671816+00:00"}
{"event": "pre_nixos.network.write_lan_rename_rule.start", "net_path": "/sys/class/net", "rules_dir": "/etc/systemd/network", "timestamp": "2025-10-19T04:08:32.672220+00:00"}
{"attempts": 30, "delay_seconds": 2.0, "event": "pre_nixos.network.wait_for_lan.start", "net_path": "/sys/class/net", "timestamp": "2025-10-19T04:08:32.673085+00:00"}
{"command": ["ip", "link", "set", "lan", "up"], "event": "pre_nixos.network.command.start", "timestamp": "2025-10-19T04:08:32.675162+00:00"}
{"command": ["ip", "link", "set", "lan", "up"], "event": "pre_nixos.network.command.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:32.760002+00:00"}
{"event": "pre_nixos.network.identify_lan.detected", "interface": "lan", "signal": "carrier", "timestamp": "2025-10-19T04:08:32.772843+00:00"}
{"event": "pre_nixos.network.wait_for_lan.detected", "interface": "lan", "timestamp": "2025-10-19T04:08:32.776617+00:00"}
{"event": "pre_nixos.network.write_lan_rename_rule.finished", "interface": "lan", "rule_path": "/etc/systemd/network/10-lan.link", "timestamp": "2025-10-19T04:08:32.782959+00:00"}
{"event": "pre_nixos.network.configure_lan.network_file_written", "network_file": "/etc/systemd/network/20-lan.network", "timestamp": "2025-10-19T04:08:32.787295+00:00"}
{"command": ["ip", "link", "set", "lan", "down"], "event": "pre_nixos.network.command.start", "timestamp": "2025-10-19T04:08:32.788568+00:00"}
{"command": ["ip", "link", "set", "lan", "down"], "event": "pre_nixos.network.command.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:32.880031+00:00"}
{"command": ["ip", "link", "set", "lan", "name", "lan"], "event": "pre_nixos.network.command.start", "timestamp": "2025-10-19T04:08:32.883993+00:00"}
{"command": ["ip", "link", "set", "lan", "name", "lan"], "event": "pre_nixos.network.command.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:33.000179+00:00"}
{"command": ["ip", "link", "set", "lan", "up"], "event": "pre_nixos.network.command.start", "timestamp": "2025-10-19T04:08:33.002054+00:00"}
{"command": ["ip", "link", "set", "lan", "up"], "event": "pre_nixos.network.command.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:33.092274+00:00"}
{"command": ["systemctl", "restart", "systemd-networkd"], "event": "pre_nixos.network.systemctl.start", "ignore_missing": true, "timestamp": "2025-10-19T04:08:33.094260+00:00"}
{"command": ["systemctl", "restart", "systemd-networkd"], "event": "pre_nixos.network.systemctl.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:35.839298+00:00"}
{"authorized_key": "/nix/store/rq9s3y0qa674hdbamqkq5zvfnsv027vp-pre-nixos-0.1.0/lib/python3.11/site-packages/pre_nixos/root_key.pub", "event": "pre_nixos.network.secure_ssh.start", "ssh_dir": "/etc/ssh", "ssh_service": "sshd", "timestamp": "2025-10-19T04:08:35.942937+00:00"}
{"authorized_keys_path": "/root/.ssh/authorized_keys", "event": "pre_nixos.network.secure_ssh.authorized_key_written", "timestamp": "2025-10-19T04:08:36.054232+00:00"}
{"command": ["systemctl", "reload-or-restart", "--no-block", "sshd"], "event": "pre_nixos.network.systemctl.start", "ignore_missing": false, "timestamp": "2025-10-19T04:08:36.065198+00:00"}
{"command": ["systemctl", "reload-or-restart", "--no-block", "sshd"], "event": "pre_nixos.network.systemctl.finished", "returncode": 0, "status": "success", "timestamp": "2025-10-19T04:08:36.462721+00:00"}
{"authorized_keys_path": "/root/.ssh/authorized_keys", "event": "pre_nixos.network.secure_ssh.finished", "timestamp": "2025-10-19T04:08:36.466652+00:00"}
{"event": "pre_nixos.network.configure_lan.finished", "interface": "lan", "network_file": "/etc/systemd/network/20-lan.network", "timestamp": "2025-10-19T04:08:36.467751+00:00"}
{
  "arrays": [],
  "vgs": [
    {
      "name": "main",
      "devices": [
        "vda2"
      ]
    }
  ],
  "lvs": [
    {
      "name": "slash",
      "vg": "main",
      "size": "3064M"
    },
    {
      "name": "swap",
      "vg": "main",
      "size": "4M"
    }
  ],
  "partitions": {
    "vda": [
      {
        "name": "vda1",
        "type": "efi"
      },
      {
        "name": "vda2",
        "type": "lvm"
      }
    ]
  },
  "disko": {
    "disk": {
      "vda": {
        "type": "disk",
        "device": "/dev/vda",
        "content": {
          "type": "gpt",
          "partitions": {
            "vda1": {
              "size": "1G",
              "type": "EF00",
              "content": {
                "type": "filesystem",
                "format": "vfat",
                "extraArgs": [
                  "-n",
                  "EFI"
                ],
                "mountpoint": "/boot",
                "mountOptions": [
                  "umask=0077"
                ]
              }
            },
            "vda2": {
              "size": "100%",
              "content": {
                "type": "lvm_pv",
                "vg": "main"
              }
            }
          }
        }
      }
    },
    "mdadm": {},
    "lvm_vg": {
      "main": {
        "type": "lvm_vg",
        "lvs": {
          "slash": {
            "size": "3064M",
            "content": {
              "type": "filesystem",
              "format": "ext4",
              "mountpoint": "/",
              "mountOptions": [
                "noatime"
              ],
              "extraArgs": [
                "-L",
                "slash"
              ]
            }
          },
          "swap": {
            "size": "4M",
            "content": {
              "type": "swap",
              "extraArgs": [
                "--label",
                "swap"
              ]
            }
          }
        }
      }
    }
  }
}
[?2004hPRE-NIXOS> cat /run/pre-nixos/storage-status 2>/dev/null || true
cat /run/pre-nixos/storage-status 2>/dev/null || true
[?2004l[?2004hPRE-NIXOS> cat /var/log/pre-nixos/disko-config.nix 2>/dev/null || true
cat /var/log/pre-nixos/disko-config.nix 2>/dev/null || true
[?2004l{
  disko.devices = builtins.fromJSON ''
    {
      "disk": {
        "vda": {
          "content": {
            "partitions": {
              "vda1": {
                "content": {
                  "extraArgs": [
                    "-n",
                    "EFI"
                  ],
                  "format": "vfat",
                  "mountOptions": [
                    "umask=0077"
                  ],
                  "mountpoint": "/boot",
                  "type": "filesystem"
                },
                "size": "1G",
                "type": "EF00"
              },
              "vda2": {
                "content": {
                  "type": "lvm_pv",
                  "vg": "main"
                },
                "size": "100%"
              }
            },
            "type": "gpt"
          },
          "device": "/dev/vda",
          "type": "disk"
        }
      },
      "lvm_vg": {
        "main": {
          "lvs": {
            "slash": {
              "content": {
                "extraArgs": [
                  "-L",
                  "slash"
                ],
                "format": "ext4",
                "mountOptions": [
                  "noatime"
                ],
                "mountpoint": "/",
                "type": "filesystem"
              },
              "size": "3064M"
            },
            "swap": {
              "content": {
                "extraArgs": [
                  "--label",
                  "swap"
                ],
                "type": "swap"
              },
              "size": "4M"
            }
          },
          "type": "lvm_vg"
        }
      },
      "mdadm": {}
    }
  '';
}
[?2004hPRE-NIXOS> ps -ef | grep -E 'disko|wipefs' | grep -v grep || true
ps -ef | grep -E 'disko|wipefs' | grep -v grep || true
[?2004lroot         893     865  2 04:08 ?        00:00:00 /nix/store/1jzhbwq5rjjaqa75z88ws2b424vh7m53-bash-5.2p32/bin/bash /nix/store/67n392qxiwrb0bsl32n81jz5f5i6nn34-disko/bin/.disko-wrapped --mode destroy,format,mount --yes-wipe-all-disks --root-mountpoint /mnt /var/log/pre-nixos/disko-config.nix
root         897     893  0 04:08 ?        00:00:00 /nix/store/1jzhbwq5rjjaqa75z88ws2b424vh7m53-bash-5.2p32/bin/bash /nix/store/67n392qxiwrb0bsl32n81jz5f5i6nn34-disko/bin/.disko-wrapped --mode destroy,format,mount --yes-wipe-all-disks --root-mountpoint /mnt /var/log/pre-nixos/disko-config.nix
root         898     897 75 04:08 ?        00:00:15 nix-build /nix/store/67n392qxiwrb0bsl32n81jz5f5i6nn34-disko/share/disko/cli.nix --no-out-link --impure --argstr mode destroy,format,mount --argstr rootMountPoint /mnt --arg diskoFile /var/log/pre-nixos/disko-config.nix
[?2004hPRE-NIXOS> lsblk --output NAME,TYPE,SIZE,MOUNTPOINT
lsblk --output NAME,TYPE,SIZE,MOUNTPOINT
[?2004lNAME  TYPE  SIZE MOUNTPOINT
fd0   disk    4K 
loop0 loop    1G /nix/.ro-store
sr0   rom   1.1G /iso
vda   disk    4G 
[?2004hPRE-NIXOS> poweroff
poweroff
[?2004l
Broadcast message from root@nixos on pts/0 (Sun 2025-10-19 04:08:39 UTC):

The system will power off now!

[?2004hPRE-NIXOS> [  153.427791] reboot: Power down
